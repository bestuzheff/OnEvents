<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OnEvents</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Актуальные события и конференции по 1С в городах России.">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@2.1.0/build/pure-min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="icons/favicon.svg">
    <link rel="shortcut icon" href="icons/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="OnEvents">
    <link rel="manifest" href="icons/site.webmanifest">    
    <!-- Yandex.Metrika counter --> <script type="text/javascript">     (function(m,e,t,r,i,k,a){         m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};         m[i].l=1*new Date();         for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}         k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)     })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=103858050', 'ym');      ym(103858050, 'init', {ssr:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true}); </script> <noscript><div><img src="https://mc.yandex.ru/watch/103858050" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- /Yandex.Metrika counter -->
    <style>
        html { scroll-behavior: smooth; }
        .sr-only {position:absolute!important;width:1px!important;height:1px!important;padding:0!important;margin:-1px!important;overflow:hidden!important;clip:rect(0,0,0,0)!important;white-space:nowrap!important;border:0!important;}

        :root {
            --bg:#fafafa; --text:#111; --muted:#666;
            --card-bg:#fff; --border:#ddd; --shadow:0 2px 4px rgba(0,0,0,.1);
            --header-bg:#222; --header-text:#fff; --footer-bg:#222; --footer-text:#ccc;
            --link:#0b76ef;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg:#0f1115; --text:#e6e6e6; --muted:#a0a0a0;
                --card-bg:#161a22; --border:#2a2f3a; --shadow:0 2px 6px rgba(0,0,0,.35);
                --header-bg:#0b0e14; --header-text:#e6e6e6; --footer-bg:#0b0e14; --footer-text:#a6a6a6;
                --link:#7cb3ff;
            }
        }
        .dark-theme {
            --bg:#0f1115; --text:#e6e6e6; --muted:#a0a0a0;
            --card-bg:#161a22; --border:#2a2f3a; --shadow:0 2px 6px rgba(0,0,0,.35);
            --header-bg:#0b0e14; --header-text:#e6e6e6; --footer-bg:#0b0e14; --footer-text:#a6a6a6;
            --link:#7cb3ff;
        }
        .light-theme {
            --bg:#fafafa; --text:#111; --muted:#666;
            --card-bg:#fff; --border:#ddd; --shadow:0 2px 4px rgba(0,0,0,.1);
            --header-bg:#222; --header-text:#fff; --footer-bg:#222; --footer-text:#ccc;
            --link:#0b76ef;
        }

        body {font-family:'JetBrains Mono', monospace;margin:0;padding:0;background:var(--bg);color:var(--text);word-break:break-word;transition:background .2s,color .2s;}
        a {color:var(--link);} a:hover {color:#a2c8ff !important;}
        header a {color:var(--header-text);} header a:hover {color:#a2c8ff !important; text-decoration:underline;}
        
        /* Темный стиль для выбора города в хедере */
        #cityFilter {
            background: #333 !important;
            color: #fff !important;
            border-color: #555 !important;
        }
        #cityFilter option {
            background: #333;
            color: #fff;
        }

        header {
            position: sticky; top: 0; z-index: 1000;
            background: var(--header-bg); color: var(--header-text);
            padding: 1em;
        }
        .header-inner {max-width:1000px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.75rem;}
        .logo {font-size:1.5em;font-weight:bold;}
        .logo-onevents {height: 32px; width: auto;}
        nav {display:flex;gap:1em;align-items:center;}
        .theme-toggle {appearance:none;background:transparent;border:none;padding:0;margin:0;line-height:1;font-size:1.15em;color:var(--header-text);cursor:pointer;}

        .container {max-width:1000px;margin:2em auto;padding:0 1em;}
        article.card {background:var(--card-bg);border:1px solid var(--border);border-radius:8px;padding:1.25em;margin-bottom:1.5em;box-shadow:var(--shadow);} 
        .card-header {display:flex;align-items:center;gap:.75em;margin-bottom:.75em;}
        .card-title {margin:0;font-size:1.5em;}
        .meta {display:block;margin:.25em 0 .5em 0;}
        .meta-item {font-size:.95em;color:var(--muted);display:flex;align-items:baseline;margin:.15em 0;}
        .meta-item .icon {margin-right:.35em;}
        .map-link {display:block;margin-top:.25em;text-decoration:none;font-size:0.9em;opacity:0.8;transition:opacity 0.2s;color:var(--link);}
        .map-link:hover {opacity:1;text-decoration:underline;}
        footer {background:var(--footer-bg);color:var(--footer-text);text-align:center;padding:1em;margin-top:2em;font-size:.9em;}

        .grid {display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));}

        .icon svg {width:20px;height:20px;fill:currentColor;}

        @media (max-width:600px) {
            .header-inner {flex-direction:column;align-items:center;text-align:center;}
            nav {margin-top:.5em;flex-direction:column;gap:.5em;}
            
            /* Увеличиваем отступ для якорных ссылок на мобильных */
            .card {
                scroll-margin-top: 160px;
            }
            
            /* Уменьшаем размер кнопки копирования на мобильных */
            .event-copy-btn {
                width: 18px;
                height: 18px;
                font-size: 12px;
                top: 0.75rem;
                right: 0.75rem;
            }
        }
        #about { scroll-margin-top: 80px; }
        #public-calendars { scroll-margin-top: 80px; }
        
        /* Дополнительные отступы для мобильных */
        @media (max-width:600px) {
            #about { scroll-margin-top: 160px; }
            #public-calendars { scroll-margin-top: 200px; }
        }
        
        /* Стили для блока публичных календарей */
        .calendar-item {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .calendar-city-name {
            color: var(--text);
            width: 140px;
            flex-shrink: 0;
            text-align: left;
        }
        .calendar-input-group {
            position: relative;
            flex: 1;
            max-width: calc(100% - 160px);
        }
        .calendar-input {
            width: 100%;
            padding: 0.5rem 2.5rem 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--bg);
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            word-break: break-all;
            box-sizing: border-box;
        }
        .calendar-copy-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 3px;
            color: var(--muted);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            font-size: 14px;
        }
        .calendar-copy-btn:hover {
            color: var(--link);
            background: var(--border);
        }
        .calendar-copy-btn:active {
            transform: translateY(-50%) scale(0.9);
        }
        
        /* Стили для кнопки копирования ссылки события */
        .event-copy-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 3px;
            color: var(--muted);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            font-size: 14px;
            z-index: 10;
        }
        .event-copy-btn:hover {
            color: var(--link);
            background: var(--border);
        }
        .event-copy-btn:active {
            transform: scale(0.9);
        }
        
        /* Стили для действий с событиями */
        .event-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        
        /* Стили для якорных ссылок */
        .card {
            scroll-margin-top: 100px;
            position: relative;
        }
        .card.highlighted {
            border-color: var(--link);
            box-shadow: 0 0 0 2px rgba(123, 179, 255, 0.2);
        }
    </style>
</head>
<body>
<div id="top"></div>
<script>(function initTheme(){try{const saved=localStorage.getItem('theme');const root=document.documentElement;if(saved==='dark'){root.classList.add('dark-theme');}else if(saved==='light'){root.classList.add('light-theme');}}catch(e){}})();</script>

<header role="banner">
  <div class="header-inner">
    <div class="logo">
      <img class="logo-onevents" src="icons/web-app-manifest-192x192.png">
      OnEvents
    </div>
    <nav aria-label="Главное меню">
      <label for="cityFilter" class="sr-only">Фильтр по городу</label>
      <select id="cityFilter" class="pure-input">
        <option value="">Все города</option>
      </select>
      <a href="#top">События</a>
      <a href="#public-calendars">Календари</a>
      <a href="#about">О проекте</a>
      <button class="theme-toggle" id="themeToggle" type="button" aria-pressed="false" aria-label="Переключить тему"><span id="themeIcon">🌓</span></button>
    </nav>
  </div>
</header>

<main class="container">
  <h1 class="sr-only">Календарь событий OnEvents</h1>

  <div id="events">
    {{ events }}
  </div>

  <!-- Блок публичных календарей -->
  <section id="public-calendars">
    {{ public_calendars }}
  </section>

  <!-- Блок О проекте -->
   
  <section id="about">
    <h2>О проекте</h2>

    <article class="card">
      <div class="card-header"><span class="icon">🎯</span><h3 class="card-title">Миссия проекта</h3></div>
      <p>Мы создаем единое информационное пространство для всех, кто работает с платформой 1С:Предприятие. Наша цель — объединить сообщество разработчиков, консультантов и пользователей, предоставив им удобную платформу для обмена знаниями и опытом.</p>
    </article>

    <h3>Что мы предлагаем</h3>
    <div class="grid">
      <article class="card"><div class="card-header"><span class="icon">📅</span><h4 class="card-title">Календарь событий</h4></div><p>Актуальная информация о предстоящих конференциях, митапах и встречах сообщества.</p></article>
      <article class="card"><div class="card-header"><span class="icon">🤝</span><h4 class="card-title">Сообщество</h4></div><p>Возможность найти единомышленников и поделиться своим опытом с коллегами.</p></article>
      <article class="card"><div class="card-header"><span class="icon">🌐</span><h4 class="card-title">Открытость</h4></div><p>Проект с открытым исходным кодом, где каждый может внести свой вклад.</p></article>
      <article class="card"><div class="card-header"><span class="icon">💬</span><h4 class="card-title">Telegram</h4></div><p>Все события дублируем и в <a href="https://t.me/OnEvents" target="_blank">Telegram</a> — подписывайтесь!</p></article>
    
    
    </div>

    <h3>Как это работает</h3>
    <div class="grid">
      <article class="card"><div class="card-header"><span class="icon">📝</span><h4 class="card-title">Создание</h4></div><p>Создайте файл с описанием события в соответствующей папке.</p></article>
      <article class="card"><div class="card-header"><span class="icon">🔍</span><h4 class="card-title">Проверка</h4></div><p>Наша команда проверит корректность информации.</p></article>
      <article class="card"><div class="card-header"><span class="icon">🚀</span><h4 class="card-title">Публикация</h4></div><p>Событие появится на сайте и станет доступно сообществу.</p></article>
      <article class="card"><div class="card-header"><span class="icon">😎</span><h4 class="card-title">Для ленивых</h4></div><p>Просто пришлите данные о событии нам на почту.</p></article>
    </div>

    <article class="card">
      <div class="card-header"><span class="icon">📬</span><h3 class="card-title">Контакты</h3></div>
      <ul>
        <li><a href="https://github.com/bestuzheff/OnEvents" target="_blank">GitHub</a></li>
        <li><a href="mailto:info@onevents.ru">info@onevents.ru</a></li>
        <li><a href="https://t.me/Un_tru" target="_blank">@Un_tru</a></li>
        <li><a href="https://t.me/bestuzheff" target="_blank">@bestuzheff</a></li>
      </ul>
    </article>
  </section>
</main>

<footer role="contentinfo"><small>© OnEvents, 2025. Дата актуальности: {{ builddate }}</small></footer>

<script>(function themeToggle(){const btn=document.getElementById('themeToggle');const icon=document.getElementById('themeIcon');const root=document.documentElement;function isDark(){return root.classList.contains('dark-theme');}function setTheme(mode){if(mode==='dark'){root.classList.remove('light-theme');root.classList.add('dark-theme');btn.setAttribute('aria-pressed','true');icon.textContent='🌙';}else{root.classList.remove('dark-theme');root.classList.add('light-theme');btn.setAttribute('aria-pressed','false');icon.textContent='☀️';}try{localStorage.setItem('theme',mode);}catch(e){}}btn.addEventListener('click',function(e){e.preventDefault();setTheme(isDark()?'light':'dark');});try{const saved=localStorage.getItem('theme');if(saved==='dark'){icon.textContent='🌙';btn.setAttribute('aria-pressed','true');}else if(saved==='light'){icon.textContent='☀️';btn.setAttribute('aria-pressed','false');}else{if(window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches){icon.textContent='🌙';btn.setAttribute('aria-pressed','true');}else{icon.textContent='☀️';btn.setAttribute('aria-pressed','false');}}}catch(e){}})();</script>
<script>
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener("click", function(e) {
    const targetId = this.getAttribute("href").substring(1);
    if (!targetId) return;
    
    const targetEl = document.getElementById(targetId);
    if (targetEl) {
      e.preventDefault();
      
      // Получаем высоту хедера
      const header = document.querySelector('header');
      const headerHeight = header ? header.offsetHeight : 0;
      
      // Дополнительный отступ для мобильных устройств
      const isMobile = window.innerWidth <= 600;
      const extraOffset = isMobile ? 40 : 20; // дополнительный отступ
      
      // Вычисляем позицию с учетом высоты хедера и дополнительного отступа
      const targetPosition = targetEl.offsetTop - headerHeight - extraOffset;
      
      // Плавный скролл к вычисленной позиции
      window.scrollTo({
        top: Math.max(0, targetPosition),
        behavior: "smooth"
      });
      
      // Обновляем URL
      history.pushState(null, "", "#" + targetId);
    }
  });
});
</script>
<script>
(function cityFilterInit(){
  const SELECT_ID = 'cityFilter';
  function getCards(){ return Array.from(document.querySelectorAll('article.card[data-city]')); }
  function getCalendarItems(){ return Array.from(document.querySelectorAll('.calendar-item[data-city]')); }
  function uniqueCities(){
    const set = new Set(getCards().map(c => (c.getAttribute('data-city')||'').trim()).filter(Boolean));
    return Array.from(set).sort((a,b) => a.localeCompare(b, 'ru'));
  }
  function buildOptions(){
    const sel = document.getElementById(SELECT_ID);
    if(!sel) return;
    const existing = new Set(Array.from(sel.options).map(o=>o.value));
    uniqueCities().forEach(city => {
      if(!existing.has(city)){
        const opt = document.createElement('option');
        opt.value = city;
        opt.textContent = city;
        sel.appendChild(opt);
      }
    });
  }
  function applyFilter(city){
    const cards = getCards();
    const calendarItems = getCalendarItems();
    
    cards.forEach(card => {
      const c = (card.getAttribute('data-city')||'').trim();
      card.style.display = (!city || c === city) ? '' : 'none';
    });
    
    calendarItems.forEach(item => {
      const c = (item.getAttribute('data-city')||'').trim();
      // Показываем календарь если:
      // 1. Нет фильтра (показываем все)
      // 2. Это общий календарь (data-city="")
      // 3. Город совпадает с фильтром
      item.style.display = (!city || c === '' || c === city) ? '' : 'none';
    });
  }
  function loadSaved(){
    try { return localStorage.getItem('cityFilter') || ''; } catch(e){ return ''; }
  }
  function saveSelected(val){
    try { localStorage.setItem('cityFilter', val || ''); } catch(e){}
  }
  function onChange(e){
    const val = e.target.value;
    saveSelected(val);
    applyFilter(val);
  }
  function init(){
    const sel = document.getElementById(SELECT_ID);
    if(!sel) return;
    buildOptions();
    const saved = loadSaved();
    if(saved){
      sel.value = saved;
    }
    sel.addEventListener('change', onChange);
    applyFilter(sel.value || '');
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

<script>
// Функциональность копирования ссылок календарей
(function copyCalendarLinks() {
  function copyToClipboard(text) {
    if (navigator.clipboard) {
      return navigator.clipboard.writeText(text);
    } else {
      // Fallback для старых браузеров
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      try {
        document.execCommand('copy');
        return Promise.resolve();
      } catch (err) {
        return Promise.reject(err);
      } finally {
        document.body.removeChild(textArea);
      }
    }
  }

  function initCopyButtons() {
    document.querySelectorAll('.calendar-copy-btn').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const input = this.closest('.calendar-input-group').querySelector('.calendar-input');
        const url = input.value;
        
        copyToClipboard(url).then(() => {
          // Временная смена иконки на галочку
          const originalText = this.textContent;
          this.textContent = '✓';
          this.style.color = 'var(--link)';
          
          setTimeout(() => {
            this.textContent = originalText;
            this.style.color = '';
          }, 2000);
        }).catch(() => {
          // Fallback - показываем URL в alert
          alert('Скопируйте ссылку: ' + url);
        });
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCopyButtons);
  } else {
    initCopyButtons();
  }
})();
</script>

<script>
// Функциональность копирования ссылок событий
(function copyEventLinks() {
  function copyToClipboard(text) {
    if (navigator.clipboard) {
      return navigator.clipboard.writeText(text);
    } else {
      // Fallback для старых браузеров
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      try {
        document.execCommand('copy');
        return Promise.resolve();
      } catch (err) {
        return Promise.reject(err);
      } finally {
        document.body.removeChild(textArea);
      }
    }
  }

  function initEventCopyButtons() {
    document.querySelectorAll('.event-copy-btn').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const eventId = this.getAttribute('data-event-id');
        const url = `${window.location.origin}${window.location.pathname}#${eventId}`;
        
        copyToClipboard(url).then(() => {
          // Временная смена иконки на галочку
          const originalText = this.textContent;
          this.textContent = '✓';
          this.style.color = 'var(--link)';
          
          setTimeout(() => {
            this.textContent = originalText;
            this.style.color = '';
          }, 2000);
        }).catch(() => {
          // Fallback - показываем URL в alert
          alert('Скопируйте ссылку: ' + url);
        });
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initEventCopyButtons);
  } else {
    initEventCopyButtons();
  }
})();
</script>

<script>
// Функциональность подсветки событий при переходе по якорной ссылке
(function highlightEvents() {
  // Подсветка события при переходе по якорной ссылке
  function highlightEventFromHash() {
    const hash = window.location.hash;
    if (hash && hash.startsWith('#event-')) {
      const eventElement = document.querySelector(hash);
      if (eventElement) {
        // Убираем предыдущую подсветку
        document.querySelectorAll('.card.highlighted').forEach(el => {
          el.classList.remove('highlighted');
        });
        
        // Добавляем подсветку к текущему событию
        eventElement.classList.add('highlighted');
        
        // Корректируем позицию скролла с учетом хедера
        setTimeout(() => {
          const header = document.querySelector('header');
          const headerHeight = header ? header.offsetHeight : 0;
          const isMobile = window.innerWidth <= 600;
          const extraOffset = isMobile ? 40 : 20;
          const targetPosition = eventElement.offsetTop - headerHeight - extraOffset;
          
          window.scrollTo({
            top: Math.max(0, targetPosition),
            behavior: "smooth"
          });
        }, 100); // небольшая задержка для корректной работы
        
        // Убираем подсветку через 3 секунды
        setTimeout(() => {
          eventElement.classList.remove('highlighted');
        }, 3000);
      }
    }
  }

  // Инициализация при загрузке страницы
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', highlightEventFromHash);
  } else {
    highlightEventFromHash();
  }

  // Обработка изменения хеша в URL
  window.addEventListener('hashchange', highlightEventFromHash);
})();
</script>
</body>
</html>
